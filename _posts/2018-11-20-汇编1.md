---
layout: post
title: 汇编（一）
feature-img: "assets/img/background/pexels-photo11.jpeg"
thumbnail: "assets/img/background/pexels-photo11.jpeg"
tags: [汇编]
---

> 越是了解自己的个性和需要，就越不容易被外界影响 <br>                       
> <p align="right">——《迷失东京》</p>
 * 用[]括起来，说明是存储器寻址，括号的内容就是偏移地址。我们能直接操作的只有偏移地址。
* AL：8位寄存器，AX：16位寄存器

## 一、立即寻址
仅适用于源操作数。
例子：MOV AX, 1200H

这样的，立即数字长是不确定...以后会知道，因为立即数前面可以无限加0

## 二、寄存器寻址
参加操作的操作数在CPU的通用寄存器里面
例子：MOV AX,BX

## 三、存储器寻址（难）

### 关注点：
1.指令操作的对象在内存中，表现形式为 **[]**
2.指令中会给出某个逻辑段中的偏移地址 **[偏移地址]**
3.逻辑段的段基地址通过默认或重设的方式给出。

**存储器操作的字长本身不确定，其字长取决于指令中另一个寄存器操作数，或通过其他方式指定**

### 1.直接寻址
 直接给出偏移地址
 例子：MOV AX, [1200H]

![png1](https://i.loli.net/2018/11/20/5bf40b2bbc710.jpg)

 
 
* 在直接寻址方式，操作数默认在数据段中，允许段重设，即由指令直接给出所在逻辑段。
例如：MOV AX, ES: [1200H]

### 2.寄存器间接寻址
操作数在内存中，数据在内存中的偏移地址在方括号中的通用寄存器的内容。

**仅有**4个通用寄存器可用于存放数据的偏移地址：**BX/BP/SI/DI**
其中BX/SI/DI默认在数据段，BP默认在堆栈段

例子：
MOV BX, 1200H
MOV AX, [BX]

![png2](https://i.loli.net/2018/11/20/5bf40b2bbc710.jpg)

> 为什么要用这种间接寻址而不是直接呢？
> 答：假如需要做0到100累加，写直接的要写100行。而这种间接寻址的，通过加偏移地址构成循环。 
### 3.寄存器相对寻址

寄存器内容加上一个位移量

如：MOV AX,[BX+DATA]
例子：
* MOV AX, 2000H
* MOV DS, AX
* MOV BX, 1200H
* MOV AL, [BX+5] ;找到的数据在数据段1205的位置拿出来

### 4.基址变址寻址
偏移地址 = 基址寄存器内容 + 变址寄存器内容 （段地址由选择的及地址寄存器决定，即若基址寄存器为BX，那么默认在数据段；若基址寄存器为BP，默认在堆栈段）
例子：
* MOV SI, 1100H
* MOV BX, SI
* MOV AX, [SI+BX]

### 5.基址变址相对寻址
偏移地址=基址寄存器内容+变址寄存器内容+位移量
例子：
* MOV DI, 1100H
* MOV BP, DI
* MOV AL, **[BP]**[DI]5

在堆栈段，2205送到AL

### 6.隐含寻址
隐含了一个或两个操作数

例子：MUL BL 即 AL*BL->AL


## 一般数据传输指令

### 1.MOV
注意：
* 两个操作数字长必须相同
* 两操作数不能同时为存储器操作数
* 两操作数不能同时为段寄存器
* 源操作数是立即数，目标操作数不能是段寄存器

### 2.PUSH & POP

PUSH AX：
SP-2->SP ;腾出空间
加到堆栈段

POP AX:
弹出到AX

注意：
* 操作数必须是16位
* 操作数可以是 寄存器或存储器两单元，但不能是立即数

### 3.交换

XCHG REG，MEM/REG
两操作数必须有一个是寄存器操作数，不能使段寄存器

例子：
XCHG AX, BX
XCHG [2000], CL

### 4.查表指令

XLAT
用BX的内容代表表格首地址，AL内容为表内位移量，BX+AL得到要查找元素的偏移地址。

字节到字的扩展命令

### 5.扩展指令
CBW 将AL内容扩展到AX
CWD 将AX内容扩展到 DX AX（最高位为1，DX=FFFFH,最高位为0，DX=0000H）

## 地址传送

### 6.取近地址指针

LEA指令 操作：将变量（内存单元的符号地址）的16位偏移地址写入到目标寄存器
**当程序中用符号表示内存偏移地址时候，必须使用LEA指令**
LEA REG, MEM
要求，源操作数是一个存储器操作数，目标操作数8个通用寄存器之一。 ax,bx,cx,dx

> 和MOV对比：这两个都是使用非常非常频繁的指令
> MOV读取的内容，而LEA读取的地址 
> 例子程序：将首地址为MEM1的50个字节的数据传送到统一逻辑段首地址为MEM2的区域存放。编写对应的程序段。
> 
> 答：
> LEA SI MEM1
> LEA DI MEM2
> MOV CL 50
> NEXT MOV AL [SI]
> MOV [DI] AL
> INC DI ; di++
> INC SI ; si++
> DNC CL ;c--
> JNC NEXT ;if(c!=0) 
### 7.LDS/LES

LEA只考虑了偏移地址，LDS和LES用于远地址，用的较少

## 输入输出
在以后会大量用到
输入：IN acc, port
输出：OUT PORT, acc  (acc:累加器  AL/AX,不能是AH) 端口地址为8位

直接寻址：直接给出8为端口地址
间接寻址：端口地址为16位时。端口地址必须由DX指定

例子：
* IN AX, 80H ;read from port 80H and write to AX
* MOV DX, 2400H
* IN AL, DX ;read from port 2400H 8bit data and write to AL
* OUT 35H, AX ; read from AX to port 35H



