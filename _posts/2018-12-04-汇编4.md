---
layout: post
title: 汇编（四）——串操作指令
feature-img: "assets/img/background/pexels-photo19.jpeg"
thumbnail: "assets/img/background/pexels-photo19.jpeg"
tags: [汇编]
---

> 一块孤独的石头，坐满整个天空。 <br>
> 他说：在这一千年李，我只热爱我自己。                          
> <p align="right">——海子</p>

<br>

## 串操作指令

* 串操作指令的操作对象是多个字节数（一串字符或数据），因此指令的执行需要确定：
    * 串所在区域
    * 串的首地址
    * 串长度
    * 串的操作方向

### 具体要求：
* 串所在区域及首地址：
    * 源串一般存放在数据段，偏移地址由SI指定，允许段重设
    * 目标串必须在附加段，偏移地址由DI指定
* 串长度：
    * 串长度由CX指定
* 串的操作方向：
    * 由DF标志位决定，DF=1减地址方向，DF=0增地址方向
* 串操作可以加重复前缀，可以实现对CX值得自动修改

### 重复前缀

#### 无重复

* REP
    * 当CX!=0,REP后的指令将继续重复执行
    * 常用于传送类指令前（未完成则继续传送）

#### 条件重复

* 相等（为0）重复：REPE(REPZ)
    * CX!=0 且 ZF=1，则前缀后的指令将继续重复执行
* 不相等（不为0）重复：REPNE(REPNZ)
    * CX!=0 且 ZF=0，则前缀后的指令继续重复执行

常用于运算指令前，当`操作未结束`并且`结果=0` 或相反，使得后面的指令继续重复执行

### 1.串传送MOVS

将源数据串传送到目标地址

> （相当于完成了 MOV [DI],[SI]）
> MOVS OPRD1, OPRD2 仅仅用在源操作数需要段重设的情况下，不常用，经常使用下面两个
> MOVSB 按字节传送
> MOVSW 按字传送

* 经常与重复前缀结合使用

例子🌰：
分别使用MOV和MOVS指令，将200个字节的数据从M1送到M2

{% highlight java%}

//MOV指令实现
    LEA SI, M1
    LEA DI, M2
    MOV CX, 200
    ;---
NEXT MOV AL, [SI]
    MOV [DI], AL
    INC SI
    INC DI
    DEC CX
    JNZ NEXT ;如果CX不等于零的话继续执行
    ;---
    HLT ;结束

//MOVS指令实现
    LEA SI, M1
    LEA DI, M2
    MOV CX, 200
    ;---
    CLD ;clear DF，即将DF标志位清零，按照增地址方向操作
    REP MOVSB ;REP完成CX--和判断CX是否为零的操作，MOVSB完成移动以及指针加的操作
    ;---
    HLT

{% endhighlight %}


### 2.串比较CMPS

用于实现两个数据串的比较

> CMPS 和MOV一样，只在段重设的时候
> CMPSB 
> CMPSW 

例子🌰：
测试200个字节的数据是否传输正确

{% highlight java%}

    LEA SI, M1
    LEA DI, M2
    MOV CX, 200
    CLD CMPSB
    JZ STOP ;相等则停止
    DEC SI ;不等则吧指针指向不等的那个数据
    MOV AL, [SI]
    MOV BX, SI
STOP HLT
    
{% endhighlight %}


### 3.串扫描SCAS

在存储区域中寻找某个关键字

> SCAS 
> SCASB
> SCASW

源操作数是AX或AL

例子🌰：
在ES段中从2000H单元开始存放了10个字符，寻找其中有无字符“A”。若有则记下搜索次数，将搜索次数写入到DATA1单元，并将存放A的地址写入DATA2单元。

{% highlight java%}

LEA DI, 2000H
MOV BX, DI
MOV CX, 10
MOV AL, 'A'
CLD ;按照增地址操作
REPNZ SCASB
JZ FOUND

{% endhighlight %}



### 4.串装入LODS

> LODS OPRD
> LODSB
> LODSW

将[DI:SI]送入AL/AX

用于将数据串依次装入累加器，常用语输入输出等等。(类似IN)

### 5.串送存STOS

> STOS OPRD
> STOSB
> STOSW

将[ES:DI]送入AL/AX

用于将内存某个区域置同样的值

此时：
* 将待送存数据放入AL、AX。
* 确定操作方向（增地址/减地址）和区域大小（串长度值）
* 使用串存储指令+**无条件重复前缀**，实现数据传输

### 小结

* 需要定义附加段，目标操作数必须在附加段
* 需要设定数据的操作方向，即确定DF的状态
* 源串和目标串指针分别为SI和DI
* 串的长度必须由CX给出
* 传送类指令前加无条件重复前缀，串比较类指令前加条件重复前缀



