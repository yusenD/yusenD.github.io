---
layout: post
title: 广播
feature-img: "assets/img/background/pexels-photo5.jpeg"
thumbnail: "assets/img/background/pexels-photo5.jpeg"
tags: [面试,Android]
---

> 欲买桂花重载酒，终不似，少年游。

<br>

* TOC
{:toc}

## Broadcast

### 定义

广播是一种广泛运用在应用程序之间传输信息的机制。发送广播的内容是Intent，里面可以携带传送的数据。

可以有通知的作用。

### 应用场景

* 同一个APP具有多个进程的不同组建之间的消息通信
* 不同APP之间通信

### 种类

* 普通广播：sendBroadcast
* 系统广播：sendOrderedBroadcast
* 本地广播：只在APP内传播

## Broadcast Receiver

有两种注册方式：

* 静态注册：直接写在manifest注册，注册完成就一直运行
* 动态注册：registryReceiver，跟随activity的生命周期，记住一定要在onDestroy里面注销广播。

## 广播实现机制

* 自定义广播接受者，重写onRecvice方法
* 通过Binder机制向AMS进行注册
* 广播发送者通过Binder机制向AMS发送广播
* AMS查找符合相应条件的BroadcastReceiver（IntentFilter/Permission等），将广播发送到BroadcastReceiver（通常是Activity）响应的消息循环队列中
* 消息循环队列拿到此广播，回调BroadcastReceiver的onReceiver()方法

## LocalBroadcastManager

* 使用它发送的广播只在自身APP内广播，不必担心泄露隐私数据。
* 其他APP无法对你的APP发送该广播，因为你的APP根本就不可能接收到非自身应用发送的该广播
* 比系统的全局广播更高效  

其实看一下源码就知道，LBM内部是通过Handler实现的，它的sendBroadcast()是通过handler发送一个message实现的。

LCM内部的协作主要是靠两个MAP集合：mReceivers和mActions，还有一个List集合mPendingBroadcasts，这个主要就是存储待接收的广播对象。

